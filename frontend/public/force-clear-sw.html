<!DOCTYPE html>
<html>
<head>
    <title>Service Worker ê°•ì œ ì œê±°</title>
    <meta charset="UTF-8">
</head>
<body>
    <h1>ğŸ”¥ Service Worker ê°•ì œ ì œê±°</h1>
    <p>ë‹¤ë¥¸ AI ê¶Œì¥ ë°©ë²•ìœ¼ë¡œ ì”ë¥˜ Service Worker ì™„ì „ ì œê±°</p>
    <div id="status">ì§„í–‰ ì¤‘...</div>
    
    <script>
    (async function() {
        const statusDiv = document.getElementById('status');
        
        function log(message) {
            console.log(message);
            statusDiv.innerHTML += '<div>' + message + '</div>';
        }
        
        try {
            log('ğŸ” Service Worker ë“±ë¡ í™•ì¸ ì¤‘...');
            
            if ('serviceWorker' in navigator) {
                // ë‹¤ë¥¸ AI ê¶Œì¥: ì •í™•í•œ ì™„ì „ ì œê±° ë°©ë²•
                const regs = await navigator.serviceWorker.getRegistrations();
                log(`ğŸ“‹ ë°œê²¬ëœ Service Worker: ${regs.length}ê°œ`);
                
                if (regs.length > 0) {
                    // ëª¨ë“  ë“±ë¡ í•´ì œ
                    await Promise.all(regs.map(async (reg) => {
                        const result = await reg.unregister();
                        log(`${result ? 'âœ…' : 'âŒ'} Service Worker ì œê±°: ${reg.scope}`);
                        return result;
                    }));
                    
                    log('ğŸ§¹ ëª¨ë“  Service Worker ì œê±° ì™„ë£Œ');
                } else {
                    log('â„¹ï¸ ë“±ë¡ëœ Service Worker ì—†ìŒ');
                }
                
                // ì¶”ê°€ ì •ë¦¬
                log('ğŸ—‘ï¸ ì¶”ê°€ ìºì‹œ ì •ë¦¬ ì¤‘...');
                
                // ëª¨ë“  ìºì‹œ ì‚­ì œ
                if ('caches' in window) {
                    const cacheNames = await caches.keys();
                    await Promise.all(cacheNames.map(name => {
                        log(`ğŸ—‚ï¸ ìºì‹œ ì‚­ì œ: ${name}`);
                        return caches.delete(name);
                    }));
                }
                
                // ì €ì¥ì†Œ ì •ë¦¬
                localStorage.clear();
                sessionStorage.clear();
                log('ğŸ§½ localStorage, sessionStorage ì •ë¦¬ ì™„ë£Œ');
                
                // IndexedDB ì •ë¦¬
                if ('indexedDB' in window) {
                    try {
                        const databases = await indexedDB.databases();
                        await Promise.all(databases.map(db => {
                            log(`ğŸ—„ï¸ IndexedDB ì‚­ì œ: ${db.name}`);
                            return new Promise((resolve) => {
                                const deleteReq = indexedDB.deleteDatabase(db.name);
                                deleteReq.onsuccess = () => resolve();
                                deleteReq.onerror = () => resolve(); // ì—ëŸ¬ ë¬´ì‹œ
                            });
                        }));
                    } catch(e) {
                        log('â„¹ï¸ IndexedDB ì •ë¦¬ ê±´ë„ˆëœ€');
                    }
                }
                
                log('âœ… ëª¨ë“  ì •ë¦¬ ì‘ì—… ì™„ë£Œ');
                log('âš ï¸ ì´ì œ ë¸Œë¼ìš°ì €ë¥¼ ê°•ì œ ìƒˆë¡œê³ ì¹¨í•˜ì„¸ìš”: Ctrl+Shift+R (ë˜ëŠ” Cmd+Shift+R)');
                
                // 3ì´ˆ í›„ ê°•ì œ ë¦¬ë‹¤ì´ë ‰íŠ¸
                setTimeout(() => {
                    log('ğŸ”„ ë©”ì¸ í˜ì´ì§€ë¡œ ê°•ì œ ë¦¬ë‹¤ì´ë ‰íŠ¸...');
                    // ìºì‹œ ë²„ìŠ¤íŒ…ìœ¼ë¡œ ì™„ì „ ìƒˆë¡œê³ ì¹¨
                    window.location.replace(`/?clear=${Date.now()}&force=true`);
                }, 3000);
                
            } else {
                log('âŒ ì´ ë¸Œë¼ìš°ì €ëŠ” Service Workerë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤');
            }
            
        } catch (error) {
            log(`âŒ ì—ëŸ¬ ë°œìƒ: ${error.message}`);
            console.error('Service Worker ì œê±° ì¤‘ ì—ëŸ¬:', error);
        }
    })();
    </script>
    
    <p><strong>ì°¸ê³ :</strong> chrome://serviceworker-internals ì—ì„œ zombie SW í™•ì¸ ê°€ëŠ¥</p>
</body>
</html>