<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>패키지 구매 테스트</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-8">
    <div class="max-w-4xl mx-auto">
        <h1 class="text-2xl font-bold mb-6">패키지 구매 모달 테스트</h1>
        
        <div class="bg-white p-6 rounded-lg shadow mb-6">
            <h2 class="text-lg font-semibold mb-4">테스트 시나리오</h2>
            <ol class="list-decimal list-inside space-y-2">
                <li>브라우저에서 <a href="http://localhost:5173" class="text-blue-600 underline">http://localhost:5173</a> 접속</li>
                <li>admin@aibio.com / admin123 으로 로그인</li>
                <li>고객 메뉴 클릭</li>
                <li>아무 고객이나 클릭하여 상세 모달 열기</li>
                <li>패키지 관리 탭 클릭</li>
                <li>패키지 구매 버튼 클릭</li>
            </ol>
        </div>

        <div class="bg-white p-6 rounded-lg shadow">
            <h2 class="text-lg font-semibold mb-4">API 테스트 결과</h2>
            <button onclick="testAPI()" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">
                API 테스트 실행
            </button>
            <div id="result" class="mt-4 p-4 bg-gray-50 rounded"></div>
        </div>
    </div>

    <script>
        async function testAPI() {
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = '<div class="text-gray-600">테스트 중...</div>';
            
            try {
                // 1. 로그인
                const loginRes = await fetch('http://localhost:8000/api/v1/auth/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded'
                    },
                    body: 'username=admin@aibio.com&password=admin123'
                });
                const loginData = await loginRes.json();
                const token = loginData.access_token;
                
                // 2. 패키지 목록 조회
                const packagesRes = await fetch('http://localhost:8000/api/v1/packages/available', {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                const packagesData = await packagesRes.json();
                
                // 3. 대시보드 통계 조회
                const statsRes = await fetch('http://localhost:8000/api/v1/dashboard/stats', {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                const statsData = await statsRes.json();
                
                resultDiv.innerHTML = `
                    <div class="space-y-4">
                        <div>
                            <h3 class="font-semibold text-green-600">✅ API 테스트 성공</h3>
                        </div>
                        <div>
                            <h4 class="font-medium">패키지 목록 (${packagesData.data.length}개)</h4>
                            <ul class="text-sm text-gray-600 mt-2">
                                ${packagesData.data.slice(0, 3).map(pkg => 
                                    `<li>- ${pkg.package_name}: ${pkg.price.toLocaleString()}원 (${pkg.total_sessions}회)</li>`
                                ).join('')}
                                ${packagesData.data.length > 3 ? '<li>...</li>' : ''}
                            </ul>
                        </div>
                        <div>
                            <h4 class="font-medium">대시보드 통계</h4>
                            <ul class="text-sm text-gray-600 mt-2">
                                <li>- 총 고객수: ${statsData.total_customers}명</li>
                                <li>- 오늘 매출: ${statsData.today_revenue.toLocaleString()}원</li>
                                <li>- 활성 패키지: ${statsData.active_packages}개</li>
                            </ul>
                        </div>
                    </div>
                `;
            } catch (error) {
                resultDiv.innerHTML = `<div class="text-red-600">오류: ${error.message}</div>`;
            }
        }
    </script>
</body>
</html>